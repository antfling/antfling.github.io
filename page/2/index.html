<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"antfling.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Es Ist Vorbei">
<meta name="keywords" content="Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Antfling">
<meta property="og:url" content="https://antfling.github.io/page/2/index.html">
<meta property="og:site_name" content="Antfling">
<meta property="og:description" content="Es Ist Vorbei">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Antfling">
<meta name="twitter:description" content="Es Ist Vorbei">

<link rel="canonical" href="https://antfling.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Antfling</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Antfling</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">雄关漫道真如铁</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://antfling.github.io/2017/09/22/web-ha/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ant">
      <meta itemprop="description" content="Es Ist Vorbei">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Antfling">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/09/22/web-ha/" class="post-title-link" itemprop="url">Web应用高并发解决思路</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-22 08:15:00" itemprop="dateCreated datePublished" datetime="2017-09-22T08:15:00+08:00">2017-09-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-29 14:52:07" itemprop="dateModified" datetime="2020-09-29T14:52:07+08:00">2020-09-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Web应用高并发解决思路"><a href="#Web应用高并发解决思路" class="headerlink" title="Web应用高并发解决思路"></a>Web应用高并发解决思路</h1><h2 id="基本解决思路："><a href="#基本解决思路：" class="headerlink" title="基本解决思路："></a>基本解决思路：</h2><h3 id="硬件方面："><a href="#硬件方面：" class="headerlink" title="硬件方面："></a>硬件方面：</h3><p>​    高性能服务器，高性能数据库，高效率的编程语言，高性能的WEB容器。</p>
<h3 id="软件方面："><a href="#软件方面：" class="headerlink" title="软件方面："></a>软件方面：</h3><ol>
<li>HTML静态化，例如目前google大力推广的angularJS+html+node.js开发模式，追求极致的高效率、高并发。html静态文件加载毫无疑问快于动态编译语言jsp,asp,php等， 另外采用ajax交互，json数据格式，达到与服务器交互最少数据，网络传输更快，自然效率更高。</li>
<li>图片服务器分离，专人专事，例如图片、html、css、js可以使用Nignx 做静态资源服务器，同时nignx也是分布式系统的前置反向代理服务器的优秀选择。</li>
<li>使用缓存技术，访问频率高，变动性小的数据可以考虑放入缓存中，如，数据字典、行政区划等。如ehcache,memecached ,redis等</li>
<li>数据库集群和库表散列</li>
<li>使用镜像：提高性能和数据安全性</li>
<li>分布式集群负载均衡</li>
<li>业务分离，功能抽取独立部署</li>
<li>动静分离，减少服务端压力。 </li>
</ol>
<h3 id="关于使用动静分离真实案例："><a href="#关于使用动静分离真实案例：" class="headerlink" title="关于使用动静分离真实案例："></a>关于使用动静分离真实案例：</h3><p>业务：</p>
<p>​     网站有对用户设置机型的功能，要把市面上90%的热门机型展示给用户，（两千多款机型，几百个系列，几十个品牌），并且能在线查看，选择，搜索他的机型。</p>
<p>土做法：</p>
<p>​     如果我们把所有机型数据放在数据库，通过用户一次查找，一次选系列，一次选品牌来发请求到后台，然后将信息反馈给用户。这样的做发会产生大量的价值不大的请求，对服务器会造成的压力。</p>
<p>新做法：</p>
<p>​     1.做一个后台的发布功能，在运营每次修改后机型数据后，点发布，将这繁多的品牌和机型生成静态JS。    </p>
<p>​     2. 精简生成的JSON数据结构（如：原来JSON里含有pbName:”摩托落拉”，优化成：b:”摩托落拉”），缩小这个JS文件大小，其实最后只有60K左右。</p>
<p>​     3. 将这个JS放在缓存里，页面上通过JS动态加载。</p>
<ol start="4">
<li>所有的操作都将在这个JS里进行，其实就是操作JSON数据。</li>
</ol>
<h2 id="java相关推荐开发框架"><a href="#java相关推荐开发框架" class="headerlink" title="java相关推荐开发框架"></a>java相关推荐开发框架</h2><p> 这里推荐下jhipster这个集成工具,这个工具使用spring boot+anjularjs为基础，可以快速的搭建一个多个微服务基础项目,之后只需要在此基础上修改即可</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://antfling.github.io/2017/08/11/vsphere/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ant">
      <meta itemprop="description" content="Es Ist Vorbei">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Antfling">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/08/11/vsphere/" class="post-title-link" itemprop="url">Vsphere虚拟机监控整理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-08-11 14:09:00" itemprop="dateCreated datePublished" datetime="2017-08-11T14:09:00+08:00">2017-08-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-29 14:52:07" itemprop="dateModified" datetime="2020-09-29T14:52:07+08:00">2020-09-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/vsphere/" itemprop="url" rel="index"><span itemprop="name">vsphere</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Vsphere虚拟机监控整理"><a href="#Vsphere虚拟机监控整理" class="headerlink" title="Vsphere虚拟机监控整理"></a>Vsphere虚拟机监控整理</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这次整理是在官方给的样例的基础上进行整理,详细的代码请参考官方开源的代码<a href="https://github.com/vmware/vsphere-automation-sdk-java" target="_blank" rel="noopener">vsphere-automation-sdk-java</a>及<a href="https://vdc-download.vmware.com/vmwb-repository/dcr-public/c9f497d8-4819-4876-a6d5-7313453dd103/a9cfaf57-f309-4af3-ba55-19dd1f617c41/vsdk_prog_guide_6_0.pdf" target="_blank" rel="noopener">官方文档</a>,网友自己翻译的<a href="http://files.cnblogs.com/files/breezee/vs_web_service_sdk_.pdf" target="_blank" rel="noopener">中文文档</a></p>
<p>本次整理主要是使用webservice去获取vcenter的相关内容，尽量使用官方已有的代码。</p>
<p>在官方的代码中还有个是使用vapi进行获取的，这个由于我测试使用的是6.0版本不支持这种用法，所以使用的是webservice即官方代码中的vim而不是vapi。</p>
<h2 id="备份知识"><a href="#备份知识" class="headerlink" title="备份知识"></a>备份知识</h2><p>建议先看下官方文档了解一下相关sdk的用法,其次呢我这里主要对经常使用的一些类解释做下翻译</p>
<h2 id="使用思路"><a href="#使用思路" class="headerlink" title="使用思路"></a>使用思路</h2><p>在vsphere使用的webservice中，所有的操作例如部署，简历快照和配置信息的查询都是依靠ManagedObjectReference这类来进行的,它有两个域，一个是type，表示是方法还是对象类型，一个是vale，如果是方法就是方法名，类型就是类型的id。</p>
<p>ManagedObjectReference不仅可以表示具体的操作方法，还可以表示返回的信息类型.</p>
<p>对于ManagedObjectReference表示的操作方法均可以在sdk中的vim25.jar下的ServiceContent中找到,而对于方法的使用可以在官方文档中进行查询找到即可.</p>
<p>对于使用webservice(vim)的所有要传递的对象和要返回的对象均在vim25.jar下</p>
<h2 id="查询使用参数的简单解释"><a href="#查询使用参数的简单解释" class="headerlink" title="查询使用参数的简单解释"></a>查询使用参数的简单解释</h2><ul>
<li>对于配置信息的查询一般使用PropertyCollector</li>
<li>使用PropertyCollector需要从serviceContent中获取PropertyCollector的ManagedObjectReference对象</li>
<li>PropertyCollector使用propertyfilterspec过滤结果,下面是相关参数<ul>
<li>propertyfilterspec 提供对对象和属性选择数据的访问。一个propertyfilterspec必须至少有一个objectspec一propertyspec</li>
<li>objectspec 标识属性集合的开始对象。一个objectspec还确定了额外的对象集合。</li>
<li>traversalspec 标识属性集合的对象类型。它还提供了一个或多个遍历库存路径。</li>
<li>SelectionSpec 作为一个占位符参照traversalspec</li>
<li>PropertySpec 标识集合的属性。</li>
<li>View Object 确定vSphere库存对象的一个子集</li>
</ul>
</li>
<li>在vsphere中所有的查询方式，都以ManagedObjectReference表示</li>
<li>查询结果是ObjectContent其中类型用ManagedObjectReference表示,结果放在一个DynamicProperty的集合中，DynamicProperty是几何元素，DynamicProperty包含结果值和结果名称</li>
</ul>
<h2 id="配置信息的查询"><a href="#配置信息的查询" class="headerlink" title="配置信息的查询"></a>配置信息的查询</h2><p>对于vcenter下的所有配置包括虚拟机,集群，数据中心,主机这几个主要的内容查询基本上都是一致的，一次可以获取所有的配置信息，或者只获取单个类型的详细的信息</p>
<p>对于配置信息的相关查询可以参考官方文档的63页的示例代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.vmware.vim25.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.HostnameVerifier;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.HttpsURLConnection;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLSession;</span><br><span class="line"><span class="keyword">import</span> javax.xml.ws.BindingProvider;</span><br><span class="line"><span class="keyword">import</span> javax.xml.ws.soap.SOAPFaultException;</span><br><span class="line"><span class="comment">// PropertyCollector example</span></span><br><span class="line"><span class="comment">// command line input: server name, user name, password</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PCollector</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">collectProperties</span><span class="params">(VimPortType methods,</span></span></span><br><span class="line"><span class="function"><span class="params">        ServiceContent sContent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// Get references to the ViewManager and PropertyCollector</span></span><br><span class="line">    ManagedObjectReference viewMgrRef = sContent.getViewManager();</span><br><span class="line">    ManagedObjectReference propColl = sContent.getPropertyCollector();<span class="comment">//获取PropertyCollector</span></span><br><span class="line">    <span class="comment">// use a container view for virtual machines to define the traversal</span></span><br><span class="line">    <span class="comment">// - invoke the VimPortType method createContainerView (corresponds</span></span><br><span class="line">    <span class="comment">//   to the ViewManager method) - pass the ViewManager MOR and</span></span><br><span class="line">    <span class="comment">//   the other parameters required for the method invocation</span></span><br><span class="line">    <span class="comment">// - createContainerView takes a string[] for the type parameter;</span></span><br><span class="line">    <span class="comment">//   declare an arraylist and add the type string to it</span></span><br><span class="line">    List&lt;String&gt; vmList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">    vmList.add(<span class="string">"VirtualMachine"</span>);</span><br><span class="line">ManagedObjectReference cViewRef = methods.createContainerView(viewMgrRef,</span><br><span class="line">        sContent.getRootFolder(),</span><br><span class="line">        vmList,</span><br><span class="line">        <span class="keyword">true</span>);<span class="comment">//获取所有虚拟机的名称</span></span><br><span class="line">    <span class="comment">// create an object spec to define the beginning of the traversal;</span></span><br><span class="line">    <span class="comment">// container view is the root object for this traversal</span></span><br><span class="line">    <span class="comment">//配置信息的获取的筛选条件 开始</span></span><br><span class="line">    ObjectSpec oSpec = <span class="keyword">new</span> ObjectSpec();</span><br><span class="line">    oSpec.setObj(cViewRef);</span><br><span class="line">    oSpec.setSkip(<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// create a traversal spec to select all objects in the view</span></span><br><span class="line">    TraversalSpec tSpec = <span class="keyword">new</span> TraversalSpec();</span><br><span class="line">    tSpec.setName(<span class="string">"traverseEntities"</span>);</span><br><span class="line">    tSpec.setPath(<span class="string">"view"</span>);</span><br><span class="line">    tSpec.setSkip(<span class="keyword">false</span>);</span><br><span class="line">    tSpec.setType(<span class="string">"ContainerView"</span>);</span><br><span class="line">    <span class="comment">// add the traversal spec to the object spec;</span></span><br><span class="line">    <span class="comment">// the accessor method (getSelectSet) returns a reference</span></span><br><span class="line">    <span class="comment">// to the mapped XML representation of the list; using this</span></span><br><span class="line">    <span class="comment">// reference to add the spec will update the list</span></span><br><span class="line">    oSpec.getSelectSet().add(tSpec);</span><br><span class="line">    <span class="comment">// specify the property for retrieval (virtual machine name)</span></span><br><span class="line">    PropertySpec pSpec = <span class="keyword">new</span> PropertySpec();</span><br><span class="line">    pSpec.setType(<span class="string">"VirtualMachine"</span>);</span><br><span class="line">    pSpec.getPathSet().add(<span class="string">"name"</span>);</span><br><span class="line">    <span class="comment">// create a PropertyFilterSpec and add the object and</span></span><br><span class="line">    <span class="comment">// property specs to it; use the getter method to reference</span></span><br><span class="line">    <span class="comment">// the mapped XML representation of the lists and add the specs</span></span><br><span class="line">    <span class="comment">// directly to the list</span></span><br><span class="line">    PropertyFilterSpec fSpec = <span class="keyword">new</span> PropertyFilterSpec();</span><br><span class="line">    fSpec.getObjectSet().add(oSpec);</span><br><span class="line">    fSpec.getPropSet().add(pSpec);</span><br><span class="line"><span class="comment">// Create a list for the filters and add the spec to it List&lt;PropertyFilterSpec&gt; fSpecList = new ArrayList&lt;PropertyFilterSpec&gt;(); fSpecList.add(fSpec);</span></span><br><span class="line"><span class="comment">// get the data from the server</span></span><br><span class="line">RetrieveOptions ro = <span class="keyword">new</span> RetrieveOptions();</span><br><span class="line">      <span class="comment">//配置信息的获取的筛选条件 结束</span></span><br><span class="line">RetrieveResult props = methods.retrievePropertiesEx(propColl,fSpecList,ro);</span><br><span class="line">    <span class="comment">// go through the returned list and print out the data</span></span><br><span class="line">    <span class="keyword">if</span> (props != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (ObjectContent oc : props.getObjects()) &#123;</span><br><span class="line">        String vmName = <span class="keyword">null</span>;</span><br><span class="line">        String path = <span class="keyword">null</span>;</span><br><span class="line">        List&lt;DynamicProperty&gt; dps = oc.getPropSet();</span><br><span class="line">    <span class="keyword">if</span> (dps != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (DynamicProperty dp : dps) &#123;</span><br><span class="line">        vmName = (String) dp.getVal();</span><br><span class="line">        path = dp.getName();</span><br><span class="line">    System.out.println(path + <span class="string">" = "</span> + vmName);</span><br><span class="line">&#125; &#125;</span><br><span class="line">&#125; &#125;</span><br><span class="line">&#125;<span class="comment">//end collectProperties()</span></span><br></pre></td></tr></table></figure>

<p>这段实例代码的重点是<strong><em>配置信息的获取的筛选条件</em></strong> 这部分，这部分其实对于集群，主机虚拟机和数据中心而言都是代码模式都是一样的，它们不一样的pSpec.setType(“VirtualMachine”);pSpec.getPathSet().add(“name”);这部分,这里只是取得一个名字，其实还可以获取其他的内容示例如下</p>
<ul>
<li>获取虚拟机所有配置信息 返回VirtualMachineSummary type=”VirtualMachine” pathSet=”summary” 包含VirtualMachineConfigSummary  等等</li>
<li>虚拟机设置VirtualMachineConfigSummary  type=”VirtualMachine” pathSet=”summary.config” 其他类似</li>
<li>数据中心DatastoreSummary type=”Datastore” pathSet=”summary”</li>
<li>主机HostListSummary type=”HostSystem” pathSet=”summary”</li>
<li>集群ClusterComputeResourceSummary type=”ClusterComputeResource” pathSet=”summary”</li>
</ul>
<p>这些返回的对象都在DynamicProperty中的value中，value是个Object,官方示例返回的是string，如果按照我上方给的五个样例返回的就是这些对象，需要注意,这些代码在这个sdk中均有封装,所以无须自己再写，其中配置信息的获取的筛选条件这部分代码没有找到，需要自己写下</p>
<h2 id="监控信息的查询"><a href="#监控信息的查询" class="headerlink" title="监控信息的查询"></a>监控信息的查询</h2><p>要想获取监控信息需要将PropertyCollector换成perfManager,相关内容请看文档197页,示例代码在201页开始到212页.</p>
<p>这里主要说下PerfCounterInfo这个类中的nameInfo说明这个指标的测量的内容(有中文描述,建议debug看下),groupInfo指的测量的对象例如cpu/disk,unitInfo是单位,rollupType是所得值的意义，例如平均值.有关PerfCounterInfo的使用请看201-203页的代码.</p>
<p>这段代码首先获取所有可以监控的指标,也就是PerfCounterInfo的集合,其中的PerfCounterInfo.key是可以看作数据库中的主键,然后根据你所要查看的对象ManagedObjectReference(可以表示虚拟机,集群，存储器或者主机等等)获取所有的实时指标值的实例集合也就是PerfMetricId集合，其中PerfMetricId中的counterId和PerfCounterInfo集合的key是对应的.</p>
<p>然后根据PerfMetricId集合查询当前的所有的指标的实时值集合PerfEntityMetricBase的子类集合,这里的PerfMetricId集合可以适当筛选出自己需要查询的指标集合.每个指标的实时值都是一个集合.然后根据PerfEntityMetricBase子类的中的集合字段PerfMetricSeries的id下的counterId和PerfCounterInfo集合的key进行对应就可以获取到对应指标的指标值.</p>
<h2 id="此sdk的使用"><a href="#此sdk的使用" class="headerlink" title="此sdk的使用"></a>此sdk的使用</h2><p>此sdk对于其他的sdk做了一定的封装对于一些信息的获取可以先继承SamplesAbstractBase,然后按照其他的样例进行重写run方法即可.其次这里不仅仅兼容6.0还可以兼容6.5及以上的版本,对于6.0建议使用vimAuthHelper.getVimPort()下面提供的一些方法，还可以自己定义，对于6.5建议使用vapiAuthHelper.getStubFactory方法</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://antfling.github.io/2017/05/10/spring-sseEmitter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ant">
      <meta itemprop="description" content="Es Ist Vorbei">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Antfling">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/05/10/spring-sseEmitter/" class="post-title-link" itemprop="url">Spring服务器发送事件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-05-10 14:22:00" itemprop="dateCreated datePublished" datetime="2017-05-10T14:22:00+08:00">2017-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-29 14:52:07" itemprop="dateModified" datetime="2020-09-29T14:52:07+08:00">2020-09-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring/" itemprop="url" rel="index"><span itemprop="name">spring</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Spring-服务器发送事件"><a href="#Spring-服务器发送事件" class="headerlink" title="Spring 服务器发送事件"></a>Spring 服务器发送事件</h1><h2 id="服务器事件发布"><a href="#服务器事件发布" class="headerlink" title="服务器事件发布"></a>服务器事件发布</h2><p>首先spring 有个应用发布器可以用来发布应用的各个事件，也可以自己继承这个发布器来实现自己特有的功能</p>
<p>Spring 的服务器服务器事件发布很简单只需要注入进来一个ApplicationEventPublisher即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ApplicationEventPublisher applicationEventPublisher;</span><br></pre></td></tr></table></figure>

<p>然后调用ApplicationEventPublisher.publishEvent(ApplicationEvent event)方法即可</p>
<h2 id="服务器发布时间的订阅"><a href="#服务器发布时间的订阅" class="headerlink" title="服务器发布时间的订阅"></a>服务器发布时间的订阅</h2><p>对于服务器事件发布的订阅是根据自己继承ApplicationEvent的子类来的,并且需要加上@EventListener注解</p>
<p>用法如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeployEventListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, SseEmitter&gt; sseEmitters = <span class="keyword">new</span> Hashtable&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deployEventHandler</span><span class="params">(DeployEvent deployEvent)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String deployEventKey = deployEvent.getDeployEventKey();</span><br><span class="line">        Object message = deployEvent.getMessage();</span><br><span class="line">        SseEmitter sseEmitter = sseEmitters.get(deployEventKey);</span><br><span class="line">        <span class="keyword">if</span> (sseEmitter == <span class="keyword">null</span>) &#123;</span><br><span class="line">            log.warn(<span class="string">"can't get sseEmitter from &#123;&#125;"</span>, deployEventKey);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        sseEmitter.send(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSseEmitters</span><span class="params">(String deployEventKey, SseEmitter sseEmitter)</span> </span>&#123;</span><br><span class="line">        sseEmitters.put(deployEventKey, sseEmitter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自定义服务器事件"><a href="#自定义服务器事件" class="headerlink" title="自定义服务器事件"></a>自定义服务器事件</h2><p>看到第二步中的DeployEvent就是自己定义的服务器事件只需要继承ApplicationEvent实现一下即可</p>
<p>如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeployEvent</span> <span class="keyword">extends</span> <span class="title">ApplicationEvent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object message;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String deployEventKey;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new ApplicationEvent.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source the object on which the event initially occurred (never &#123;<span class="doctag">@code</span> null&#125;)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DeployEvent</span><span class="params">(Object source, String deployEventKey, Object message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(source);</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">        <span class="keyword">this</span>.deployEventKey = deployEventKey;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>使用代码示例如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">controller</span></span>&#123;</span><br><span class="line"> 	<span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationEventPublisher applicationEventPublisher;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeployEventListener deployEventListener;</span><br><span class="line">    </span><br><span class="line">  	<span class="meta">@RequestMapping</span>(<span class="string">"/publish/&#123;param&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">publish</span><span class="params">(@PathVariable String param)</span> </span>&#123;</span><br><span class="line">        applicationEventPublisher.publishEvent(<span class="keyword">new</span> DeployEvent(<span class="keyword">this</span>, param + <span class="string">"_test"</span>, <span class="string">"test"</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"platform/test"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/deployEvent/&#123;param&#125;"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SseEmitter <span class="title">deployEvent</span><span class="params">(@PathVariable String param)</span> </span>&#123;</span><br><span class="line">        SseEmitter sseEmitter = <span class="keyword">new</span> SseEmitter();</span><br><span class="line">        deployEventListener.addSseEmitters(param + <span class="string">"_test"</span>, sseEmitter);</span><br><span class="line">        <span class="keyword">return</span> sseEmitter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://antfling.github.io/2017/04/25/h2-databse-function/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ant">
      <meta itemprop="description" content="Es Ist Vorbei">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Antfling">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/25/h2-databse-function/" class="post-title-link" itemprop="url">H2Database自定义函数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-04-25 10:27:00" itemprop="dateCreated datePublished" datetime="2017-04-25T10:27:00+08:00">2017-04-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-29 14:52:07" itemprop="dateModified" datetime="2020-09-29T14:52:07+08:00">2020-09-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/h2/" itemprop="url" rel="index"><span itemprop="name">h2</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="H2Database自定义函数"><a href="#H2Database自定义函数" class="headerlink" title="H2Database自定义函数"></a>H2Database自定义函数</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>h2数据库其实更多的用在开发中，因为可以内嵌，所以一般作为内存数据库，随用随创，随时删除。其中spring data jpa就使用到了这个数据库，再加上数据库版本控制工具flyway或者liquibase，就可以方便的在各个数据库中进行迁移和升级，我现在一般的工作的方式是开发在h2数据库中，生产环境是mysql的。但是h2在迁移的过程中sql其实很多是通用的。但是不可避免的会出现某些数据库有的函数，h2中没有的情况。所以今天就介绍一下在内嵌的h2数据库中使用自定义函数</p>
<h2 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h2><p>首先我这边使用的是spring data jpa和liquibase,项目只需要加个h2database的依赖就可以使用h2点内嵌数据库.简单配置如下</p>
<ul>
<li>gradle中依赖配置</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile(<span class="string">'org.springframework.boot:spring-boot-starter-data-jpa'</span>)</span><br><span class="line">    runtime(<span class="string">'org.liquibase:liquibase-core'</span>)</span><br><span class="line">    runtime(<span class="string">'com.h2database:h2'</span>)</span><br><span class="line">    runtime(<span class="string">'mysql:mysql-connector-java'</span>)</span><br><span class="line">    testCompile(<span class="string">"junit:junit"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Spring boot 配置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">liquibase.change-log=classpath:/db/develop/db.changelog-master.yaml</span><br><span class="line">#liquibase.url=</span><br><span class="line">#liquibase.password=</span><br><span class="line">#liquibase.user=</span><br><span class="line">#liquibase.rollback-file=</span><br><span class="line"># JPA</span><br><span class="line">spring.jpa.properties.hibernate.hbm2ddl.import_files = classpath:db/develop/import.sql</span><br><span class="line">spring.jpa.show-sql=true</span><br><span class="line">spring.jpa.hibernate.ddl-auto=create-drop</span><br><span class="line"></span><br><span class="line"># H2 Web Console (H2ConsoleProperties)</span><br><span class="line">spring.h2.console.enabled=true</span><br><span class="line">spring.h2.console.path=/h2-console</span><br></pre></td></tr></table></figure>

<p>这里解释下liquibase的配置是加载升级的yaml文件，具体的文件格式可以去参考liquibase官网这里我简单的展示一下db.changelog-master.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">databaseChangeLog:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">include:</span></span><br><span class="line">        <span class="attr">id:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">author:</span> <span class="string">dzg</span></span><br><span class="line">        <span class="attr">file:</span> <span class="string">classpath:db/develop/import.sql</span></span><br></pre></td></tr></table></figure>

<p>jpa的配置ddl-auto在生产环境中配置成validation,hibernate.hbm2ddl.import_files是不需要配置，只是为了初始化开发的时候内存数据库.</p>
<p>h2的配置就两个，第二个是可以在浏览器访问h2的url链接，默认用户sa,密码无，默认jdbc链接jdbc:h2:mem:testdb</p>
<h2 id="自定义函数"><a href="#自定义函数" class="headerlink" title="自定义函数"></a>自定义函数</h2><p>我这是参考h2官网的<a href="http://h2database.com/html/features.html#user_defined_functions" target="_blank" rel="noopener">自定义函数</a>,自己能看懂最好,官网介绍的有两种一种是引入java类的形式，方法必须是公开静态的，官网有例子，另外一种就是直接源码的形式可以去看官网的第二个例子。</p>
<p>我这里使用的是第一种方式。由于需要临时编译，所以java库中需要tools.jar包,我这是开发环境，肯定是有的。</p>
<p>首先我建立了自己的函数如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.h2.databse.function;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> dzg</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2017/4/25.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Function</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">GetNumericIP</span><span class="params">(String standardIP)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (standardIP != <span class="keyword">null</span> &amp;&amp; standardIP.length() &gt;= <span class="number">4</span>) &#123;</span><br><span class="line">            String[] ipStr = standardIP.split(<span class="string">"\\."</span>);</span><br><span class="line">            <span class="keyword">if</span> (ipStr.length == <span class="number">4</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> (Long.valueOf(ipStr[<span class="number">0</span>]) &lt;&lt; <span class="number">24</span>) + (Long.valueOf(ipStr[<span class="number">1</span>]) &lt;&lt; <span class="number">16</span>) +</span><br><span class="line">                        (Long.valueOf(ipStr[<span class="number">2</span>]) &lt;&lt; <span class="number">8</span>) + (Long.valueOf(ipStr[<span class="number">3</span>]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">GetStandardIP</span><span class="params">(<span class="keyword">long</span> numericIP)</span> </span>&#123;</span><br><span class="line">        String w = String.valueOf(numericIP &gt;&gt; <span class="number">24</span>);</span><br><span class="line">        String x = String.valueOf((numericIP &gt;&gt; <span class="number">16</span>) % <span class="number">256</span>);</span><br><span class="line">        String y = String.valueOf((numericIP &gt;&gt; <span class="number">8</span>) % <span class="number">256</span>);</span><br><span class="line">        String z = String.valueOf(numericIP % <span class="number">256</span>);</span><br><span class="line">        <span class="keyword">return</span> w + <span class="string">"."</span> + x + <span class="string">"."</span> + y + <span class="string">"."</span> + z;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我在我的import.sql中加了一句sql如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">ALIAS</span> <span class="keyword">INET_ATON</span> <span class="keyword">FOR</span> <span class="string">"org.h2.databse.function.Function.GetNumericIP"</span>;</span><br></pre></td></tr></table></figure>

<p>之后就可以正常的使用INET_ATON这个函数了,也不会出现问题</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://antfling.github.io/2017/04/21/gitlab-runner-openshirt/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ant">
      <meta itemprop="description" content="Es Ist Vorbei">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Antfling">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/21/gitlab-runner-openshirt/" class="post-title-link" itemprop="url">gitlab-runner-openshirt使用帮助</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-04-21 08:44:00" itemprop="dateCreated datePublished" datetime="2017-04-21T08:44:00+08:00">2017-04-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-29 14:52:07" itemprop="dateModified" datetime="2020-09-29T14:52:07+08:00">2020-09-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/gitlab/" itemprop="url" rel="index"><span itemprop="name">gitlab</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="gitlab-runner-openshirt使用帮助"><a href="#gitlab-runner-openshirt使用帮助" class="headerlink" title="gitlab-runner-openshirt使用帮助"></a>gitlab-runner-openshirt使用帮助</h1><h2 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h2><p>需要事先安装好<a href="https://about.gitlab.com/" target="_blank" rel="noopener">gitlab</a>和<a href="https://github.com/openshift/origin/" target="_blank" rel="noopener">openshirt</a> 这两个都可以使用docker进行安装</p>
<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>首先在gitlab上创建项目，项目是新创建的或者从github上clone下来一个也行.</p>
<h2 id="注册runner"><a href="#注册runner" class="headerlink" title="注册runner"></a>注册runner</h2><p>需要注册runner,进入上一步创建好的项目，右上角有个设置按钮,点击runners,然后看下左下角有个框里面有ci的地址和runners token</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-runner register</span><br></pre></td></tr></table></figure>

<p>然后回车根据提示分别输入name,token,url,image,tag,然后修改下面的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/gitlab-runner/config.toml</span><br></pre></td></tr></table></figure>

<p>有些没有配置改成如下格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[[runners]]</span><br><span class="line">  name = &quot;nxms-schedule&quot;</span><br><span class="line">  url = &quot;http://gitlab.domain.com/ci&quot;</span><br><span class="line">  token = &quot;aace475d58597a86ef5df6a5765244&quot;</span><br><span class="line">  executor = &quot;docker&quot;</span><br><span class="line">  [runners.docker]</span><br><span class="line">    tls_verify = false</span><br><span class="line">    image = &quot;openshift-deploy-uniqueskills:12&quot;</span><br><span class="line">    privileged = true</span><br><span class="line">    disable_cache = false</span><br><span class="line">    volumes = [&quot;/var/run/docker.sock:/var/run/docker.sock&quot;,&quot;/cache&quot;]</span><br><span class="line">    pull_policy = &quot;if-not-present&quot;</span><br><span class="line">  [runners.cache]</span><br></pre></td></tr></table></figure>

<p>然后执行下民等两个命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gitlab-runner stop</span><br><span class="line">gitlab-runner start</span><br></pre></td></tr></table></figure>

<p>切记每个项目都只能有一个自己的runner</p>
<h2 id="第一次构建项目"><a href="#第一次构建项目" class="headerlink" title="第一次构建项目"></a>第一次构建项目</h2><p>写好gitlab-ci和相关的dockerfile提交进行第一次构建</p>
<p>gitlab-ci文件gitlab会提供模版具体可以点击gitlab界面上右上角的设置，以前是service现在是intergrations选项，按照指示一步一步鞋即可，或者可参考下面的官方视频，记得需要连接vpn</p>
<p><a href="https://about.gitlab.com/2016/12/22/gitlab-8-15-released/?utm_medium=email&utm_source=marketo&utm_campaign=survey+newsletter&utm_content=december+22+2016&mkt_tok=eyJpIjoiWlRjeU56QTNZek00WVRaaCIsInQiOiJsZ3g5TWlVK1B1cnhHMkpvc3QzSjdld3p0Mkp1NFRKODl5aVJpOVZ2UFBXSkFPcFhxeXMrcytXV0I3bzJHeXQ0U09SWGhPTEJ6Zk1RRENRdUh6Mmhlc3RJcmRrb3VkbURiZndxRUtUVG9wVHFaSWNqWWlsTGJjSnBiN0Q4cG5FeiJ9" target="_blank" rel="noopener">官方教程</a></p>
<h2 id="注册project"><a href="#注册project" class="headerlink" title="注册project"></a>注册project</h2><p>在openshirt上出现项目名后执行下面，进入openshirt服务器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oc login</span><br></pre></td></tr></table></figure>

<p>输入用户名密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oc project project_name</span><br></pre></td></tr></table></figure>

<p>然后执行下面三句话</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oc secrets new-dockercfg registry.domain.com --docker-server=registry.domain.com:5000 --docker-username=origin --docker-password=origin123 --docker-email=origin@domain.com</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oc secrets new-dockercfg gitlab.domain.com --docker-server=gitlab.domain.com --docker-username=origin --docker-password=origin123 --docker-email=origin@domain.com</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oc secrets link default registry.domain.com --for=pull</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://antfling.github.io/2017/03/08/jmxMonitor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ant">
      <meta itemprop="description" content="Es Ist Vorbei">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Antfling">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/03/08/jmxMonitor/" class="post-title-link" itemprop="url">jmx监控was和websphere</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-08 08:35:00" itemprop="dateCreated datePublished" datetime="2017-03-08T08:35:00+08:00">2017-03-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-29 14:52:07" itemprop="dateModified" datetime="2020-09-29T14:52:07+08:00">2020-09-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/monitor/" itemprop="url" rel="index"><span itemprop="name">monitor</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="jmx监控"><a href="#jmx监控" class="headerlink" title="jmx监控"></a>jmx监控</h1><h2 id="WepSphere-监控"><a href="#WepSphere-监控" class="headerlink" title="WepSphere 监控"></a>WepSphere 监控</h2><ul>
<li>方式1</li>
</ul>
<p>在was上安装一个应用程序PerfServletApp.ear(在{was_home/WebSphere/AppServer/installableApps下}</p>
<p>然后访问连接<a href="http://192.168.1.54:9080/wasPerfTool/servlet/perfservlet" target="_blank" rel="noopener">wasserver</a></p>
<ul>
<li>方式2如下</li>
</ul>
<h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><ul>
<li>ibmkeycert.jar (在was所在目录:{was_home}/installationmanager/eclipse/jre-{version}/jre/lib/ext/)</li>
</ul>
<ul>
<li>com.ibm.ws.admin.client_{version}.jar (在was所在目录:{was_home}/AppServer/runtimes/)</li>
<li>ibmjgssprovider.jar  ({was_home}/AppServer/java/jre/lib/)</li>
<li>ibmorb.jar  ({was_home}/AppServer/java/jre/lib/)</li>
<li>com.ibm.jaxws.thinclient_{version}.jar(在was所在目录:{was_home}/AppServer/runtimes/)</li>
<li>javax.management.j2ee-api-1.1.1.jar 可从maven仓库下载</li>
</ul>
<h4 id="证书创建"><a href="#证书创建" class="headerlink" title="证书创建"></a>证书创建</h4><p>参考链接<a href="[http://yunzhu.iteye.com/blog/1825874](http://yunzhu.iteye.com/blog/1825874)">was证书及导入</a></p>
<h4 id="连接示例"><a href="#连接示例" class="headerlink" title="连接示例"></a>连接示例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">           Properties adminProps = new Properties();</span><br><span class="line">           adminProps.setProperty(&quot;type&quot;, &quot;soap&quot;);</span><br><span class="line">           adminProps.setProperty(&quot;host&quot;, &quot;192.168.1.54&quot;);</span><br><span class="line">           adminProps.setProperty(&quot;port&quot;, &quot;8880&quot;);</span><br><span class="line">           adminProps.setProperty(AdminClient.USERNAME, &quot;username&quot;);</span><br><span class="line">           adminProps.setProperty(AdminClient.PASSWORD, &quot;password&quot;);</span><br><span class="line">           adminProps.setProperty(AdminClient.CONNECTOR_SECURITY_ENABLED, &quot;true&quot;);</span><br><span class="line">           adminProps.setProperty(&quot;javax.net.ssl.trustStore&quot;, &quot;/Users/ksdhc/Documents/was-keystore/trustStore.jks&quot;);</span><br><span class="line">           adminProps.setProperty(&quot;javax.net.ssl.keyStore&quot;, &quot;/Users/ksdhc/Documents/was-keystore/keyStore.jks&quot;);</span><br><span class="line">           adminProps.setProperty(&quot;javax.net.ssl.trustStorePassword&quot;, &quot;trustStorePassword&quot;);</span><br><span class="line">           adminProps.setProperty(&quot;javax.net.ssl.keyStorePassword&quot;, &quot;keyStorePassword&quot;);</span><br><span class="line">           AdminClient adminClient = AdminClientFactory.createAdminClient(adminProps);</span><br><span class="line">           //获取所有有objectName</span><br><span class="line">           System.out.println(&quot;-------&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;-------start------------&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;-----------&quot;);</span><br><span class="line">           ObjectName objectName = new ObjectName(&quot;WebSphere:*&quot;);</span><br><span class="line">           Set&lt;ObjectName&gt; names = adminClient.queryNames(objectName, null);</span><br><span class="line">           for (ObjectName name : names) &#123;</span><br><span class="line">               System.out.println(&quot;name:&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;:&quot; + name);</span><br><span class="line">           &#125;</span><br><span class="line">           System.out.println(&quot;-------&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;-------end------------&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;-----------&quot;);</span><br><span class="line">       &#125; catch (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>不建议使用jmx监控，因为需要创建证书并且重启was，这在已经生产环境中是不可允许的</p>
<h2 id="Weblogic-监控"><a href="#Weblogic-监控" class="headerlink" title="Weblogic 监控"></a>Weblogic 监控</h2><h3 id="依赖-1"><a href="#依赖-1" class="headerlink" title="依赖"></a>依赖</h3><h4 id="9-x"><a href="#9-x" class="headerlink" title="9.x"></a>9.x</h4><p>wlclient.jar、wljmxclient.jar 在%WL_HOME%\server\lib目录下</p>
<h4 id="10-x"><a href="#10-x" class="headerlink" title="10.x"></a>10.x</h4><p> wlfullclient.jar 在%WL_HOME%\server\lib目录下java -jar wljarbuilder.jar 生成</p>
<h3 id="需要监控的内容"><a href="#需要监控的内容" class="headerlink" title="需要监控的内容"></a>需要监控的内容</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;JMX Connector Server started at service:jmx:iiop://150.221.74.59:7001/jndi/weblogic.management.mbeanservers.domainruntime.&gt;</span><br><span class="line">&lt;JMX Connector Server started at service:jmx:iiop://150.221.74.59:7001/jndi/weblogic.management.mbeanservers.runtime.&gt; </span><br><span class="line">&lt;JMX Connector Server started at service:jmx:iiop://150.221.74.59:7001/jndi/weblogic.management.mbeanservers.edit.&gt;</span><br></pre></td></tr></table></figure>

<h3 id="连接示例代码"><a href="#连接示例代码" class="headerlink" title="连接示例代码"></a>连接示例代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">private static MBeanServerConnection connection;</span><br><span class="line">    private static JMXConnector connector;</span><br><span class="line">    private static ObjectName domainRuntime;</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            domainRuntime = new ObjectName(DomainRuntimeServiceMBean.OBJECT_NAME);</span><br><span class="line">        &#125; catch (MalformedObjectNameException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        String hostname = &quot;localhost&quot;;</span><br><span class="line">        String portString = &quot;7001&quot;;</span><br><span class="line">        String username = &quot;weblogic&quot;;</span><br><span class="line">        String password = &quot;weblogic123456&quot;;</span><br><span class="line">        initConnection(hostname, portString, username, password);</span><br><span class="line">        getObjectNames(getDomainServerRuntime());</span><br><span class="line">        connector.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void initConnection(String hostname, String portString,</span><br><span class="line">                                       String username, String password) throws IOException &#123;</span><br><span class="line">        String protocol = Environment.LOCAL_URL_PROTOCOL;</span><br><span class="line">        int port = Integer.valueOf(portString);</span><br><span class="line">        String jndiroot = &quot;/jndi/&quot;;</span><br><span class="line">        //指定server runtime的package</span><br><span class="line">        String mserver = DomainRuntimeServiceMBean.MBEANSERVER_JNDI_NAME;</span><br><span class="line">        JMXServiceURL serviceURL = new JMXServiceURL(protocol, hostname, port, jndiroot + mserver);</span><br><span class="line">        Hashtable&lt;String, String&gt; hashtable = new Hashtable&lt;&gt;();</span><br><span class="line">        hashtable.put(Context.SECURITY_PRINCIPAL, username);</span><br><span class="line">        hashtable.put(Context.SECURITY_CREDENTIALS, password);</span><br><span class="line">        //指定提供jmx factory实现的包名</span><br><span class="line">        hashtable.put(JMXConnectorFactory.PROTOCOL_PROVIDER_PACKAGES, &quot;weblogic.management.remote&quot;);</span><br><span class="line">        connector = JMXConnectorFactory.connect(serviceURL, hashtable);</span><br><span class="line">        connection = connector.getMBeanServerConnection();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static ObjectName[] getDomainServerRuntime() throws Exception &#123;</span><br><span class="line">        return (ObjectName[]) connection.getAttribute(domainRuntime, &quot;ServerRuntimes&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void getObjectNames(ObjectName[] serverRT) throws Exception &#123;</span><br><span class="line">        for (ObjectName aServerRT : serverRT) &#123;</span><br><span class="line">            getObjectName(aServerRT);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void getObjectName(ObjectName aServerRT) throws Exception &#123;</span><br><span class="line">        String name = (String) connection.getAttribute(aServerRT, &quot;Name&quot;);</span><br><span class="line">        try &#123;</span><br><span class="line">            String state = (String) connection.getAttribute(aServerRT, &quot;State&quot;);</span><br><span class="line">            System.out.println(&quot;Server name: &quot; + name + &quot;.Server state: &quot; + state);</span><br><span class="line">        &#125; catch (MBeanException | ReflectionException | IOException | AttributeNotFoundException | InstanceNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ObjectName[] appRT = (ObjectName[]) connection.getAttribute(aServerRT, &quot;ApplicationRuntimes&quot;);</span><br><span class="line">        for (ObjectName anAppRT : appRT) &#123;</span><br><span class="line">            System.out.println(&quot;Application name: &quot; + connection.getAttribute(anAppRT, &quot;Name&quot;));</span><br><span class="line"></span><br><span class="line">            ObjectName[] compRT = (ObjectName[]) connection.getAttribute(anAppRT, &quot;ComponentRuntimes&quot;);</span><br><span class="line">            for (ObjectName aCompRT : compRT) &#123;</span><br><span class="line">                String componentName = (String) connection.getAttribute(aCompRT, &quot;Name&quot;);</span><br><span class="line">                String componentType = (String) connection.getAttribute(</span><br><span class="line">                        aCompRT, &quot;Type&quot;);</span><br><span class="line">                System.out.println(&quot;  Component name: &quot; + componentName + &quot; , Component type: &quot; + componentType);</span><br><span class="line"></span><br><span class="line">                if (componentType.equals(&quot;WebAppComponentRuntime&quot;)) &#123;</span><br><span class="line">                    ObjectName[] servletRTs = (ObjectName[]) connection.getAttribute(aCompRT, &quot;Servlets&quot;);</span><br><span class="line">                    for (ObjectName servletRT : servletRTs) &#123;</span><br><span class="line">                        System.out.println(&quot;    Servlet name: &quot; + connection.getAttribute(servletRT, &quot;Name&quot;));</span><br><span class="line">                        System.out.println(&quot;       Servlet context path: &quot; + connection.getAttribute(servletRT, &quot;ContextPath&quot;));</span><br><span class="line">                        System.out.println(&quot;       Invocation Total Count : &quot; + connection.getAttribute(servletRT, &quot;InvocationTotalCount&quot;));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="监控官方文档"><a href="#监控官方文档" class="headerlink" title="监控官方文档"></a>监控官方文档</h3><p><a href="http://docs.oracle.com/cd/E13222_01/wls/docs90/jmx/accessWLS.html" target="_blank" rel="noopener">9.x文档</a></p>
<p><a href="http://docs.oracle.com/cd/E11035_01/wls100/jmx/accessWLS.html" target="_blank" rel="noopener">10.x文档</a></p>
<p><a href="http://docs.oracle.com/cd/E13222_01/wls/docs90/wlsmbeanref/core/index.html" target="_blank" rel="noopener">MBean Document</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://antfling.github.io/2017/03/08/quartz/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ant">
      <meta itemprop="description" content="Es Ist Vorbei">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Antfling">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/03/08/quartz/" class="post-title-link" itemprop="url">quartz的使用配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-08 08:35:00" itemprop="dateCreated datePublished" datetime="2017-03-08T08:35:00+08:00">2017-03-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-29 14:52:07" itemprop="dateModified" datetime="2020-09-29T14:52:07+08:00">2020-09-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/quartz/" itemprop="url" rel="index"><span itemprop="name">quartz</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="quartz的使用"><a href="#quartz的使用" class="headerlink" title="quartz的使用"></a>quartz的使用</h1><h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>quartz是一个任务调度框架，可以实现动态添加任务和删除任务。任务的运行可以使用cron表达进行控制。可以以集群的方式进行运行。</p>
<h2 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h2><ul>
<li>quartz-2.1.7.jar</li>
<li>spring-boot-web project</li>
</ul>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="quartz-的配置-集群"><a href="#quartz-的配置-集群" class="headerlink" title="quartz 的配置(集群)"></a>quartz 的配置(集群)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">org.quartz.scheduler.instanceName: org.springframework.scheduling.quartz.SchedulerFactoryBean#0</span><br><span class="line">org.quartz.scheduler.instanceId: AUTO</span><br><span class="line"></span><br><span class="line">org.quartz.scheduler.skipUpdateCheck: true</span><br><span class="line"></span><br><span class="line">#============================================================================</span><br><span class="line"># Configure ThreadPool</span><br><span class="line">#============================================================================</span><br><span class="line"></span><br><span class="line">org.quartz.threadPool.class: org.quartz.simpl.SimpleThreadPool</span><br><span class="line">org.quartz.threadPool.threadCount: 10</span><br><span class="line">org.quartz.threadPool.threadPriority: 5</span><br><span class="line"></span><br><span class="line">#============================================================================</span><br><span class="line"># Configure JobStore</span><br><span class="line">#============================================================================</span><br><span class="line"></span><br><span class="line">org.quartz.jobStore.misfireThreshold: 60000</span><br><span class="line"></span><br><span class="line">org.quartz.jobStore.class=org.quartz.impl.jdbcjobstore.JobStoreTX</span><br><span class="line">org.quartz.jobStore.driverDelegateClass=org.quartz.impl.jdbcjobstore.StdJDBCDelegate</span><br><span class="line">org.quartz.jobStore.useProperties=false</span><br><span class="line">org.quartz.jobStore.dataSource=myDS</span><br><span class="line">org.quartz.jobStore.tablePrefix=QRTZ_</span><br><span class="line">org.quartz.jobStore.isClustered=true</span><br><span class="line"></span><br><span class="line">org.quartz.dataSource.myDS.driver: com.mysql.jdbc.Driver</span><br><span class="line">org.quartz.dataSource.myDS.URL: jdbc:mysql://192.168.1.160:3306/schedule_develop</span><br><span class="line">org.quartz.dataSource.myDS.user: root</span><br><span class="line">org.quartz.dataSource.myDS.password: 123456</span><br><span class="line">org.quartz.dataSource.myDS.maxConnections: 5</span><br><span class="line">org.quartz.dataSource.myDS.validationQuery: select 0</span><br></pre></td></tr></table></figure>

<h3 id="quartz-表的创建，脚本来自quartz的官方"><a href="#quartz-表的创建，脚本来自quartz的官方" class="headerlink" title="quartz 表的创建，脚本来自quartz的官方"></a>quartz 表的创建，脚本来自quartz的官方</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Quartz seems to work best with the driver mm.mysql-2.0.7-bin.jar</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># PLEASE consider using mysql with innodb tables to avoid locking issues</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In your Quartz properties file, you''ll need to set </span></span><br><span class="line"><span class="comment"># org.quartz.jobStore.driverDelegateClass = org.quartz.impl.jdbcjobstore.StdJDBCDelegate</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> QRTZ_FIRED_TRIGGERS;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> QRTZ_PAUSED_TRIGGER_GRPS;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> QRTZ_SCHEDULER_STATE;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> QRTZ_LOCKS;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> QRTZ_SIMPLE_TRIGGERS;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> QRTZ_SIMPROP_TRIGGERS;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> QRTZ_CRON_TRIGGERS;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> QRTZ_BLOB_TRIGGERS;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> QRTZ_TRIGGERS;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> QRTZ_JOB_DETAILS;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> QRTZ_CALENDARS;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> QRTZ_JOB_DETAILS</span><br><span class="line">(</span><br><span class="line">  SCHED_NAME        <span class="built_in">VARCHAR</span>(<span class="number">120</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  JOB_NAME          <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  JOB_GROUP         <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  DESCRIPTION       <span class="built_in">VARCHAR</span>(<span class="number">250</span>) <span class="literal">NULL</span>,</span><br><span class="line">  JOB_CLASS_NAME    <span class="built_in">VARCHAR</span>(<span class="number">250</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  IS_DURABLE        <span class="built_in">VARCHAR</span>(<span class="number">1</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  IS_NONCONCURRENT  <span class="built_in">VARCHAR</span>(<span class="number">1</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  IS_UPDATE_DATA    <span class="built_in">VARCHAR</span>(<span class="number">1</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  REQUESTS_RECOVERY <span class="built_in">VARCHAR</span>(<span class="number">1</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  JOB_DATA          <span class="built_in">BLOB</span>         <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (SCHED_NAME, JOB_NAME, JOB_GROUP)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> QRTZ_TRIGGERS</span><br><span class="line">(</span><br><span class="line">  SCHED_NAME     <span class="built_in">VARCHAR</span>(<span class="number">120</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  TRIGGER_NAME   <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  TRIGGER_GROUP  <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  JOB_NAME       <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  JOB_GROUP      <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  DESCRIPTION    <span class="built_in">VARCHAR</span>(<span class="number">250</span>) <span class="literal">NULL</span>,</span><br><span class="line">  NEXT_FIRE_TIME <span class="built_in">BIGINT</span>(<span class="number">13</span>)   <span class="literal">NULL</span>,</span><br><span class="line">  PREV_FIRE_TIME <span class="built_in">BIGINT</span>(<span class="number">13</span>)   <span class="literal">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIORITY</span>       <span class="built_in">INTEGER</span>      <span class="literal">NULL</span>,</span><br><span class="line">  TRIGGER_STATE  <span class="built_in">VARCHAR</span>(<span class="number">16</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  TRIGGER_TYPE   <span class="built_in">VARCHAR</span>(<span class="number">8</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  START_TIME     <span class="built_in">BIGINT</span>(<span class="number">13</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  END_TIME       <span class="built_in">BIGINT</span>(<span class="number">13</span>)   <span class="literal">NULL</span>,</span><br><span class="line">  CALENDAR_NAME  <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="literal">NULL</span>,</span><br><span class="line">  MISFIRE_INSTR  <span class="built_in">SMALLINT</span>(<span class="number">2</span>)  <span class="literal">NULL</span>,</span><br><span class="line">  JOB_DATA       <span class="built_in">BLOB</span>         <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),</span><br><span class="line">  <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (SCHED_NAME, JOB_NAME, JOB_GROUP)</span><br><span class="line">  <span class="keyword">REFERENCES</span> QRTZ_JOB_DETAILS (SCHED_NAME, JOB_NAME, JOB_GROUP)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> QRTZ_SIMPLE_TRIGGERS</span><br><span class="line">(</span><br><span class="line">  SCHED_NAME      <span class="built_in">VARCHAR</span>(<span class="number">120</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  TRIGGER_NAME    <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  TRIGGER_GROUP   <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  REPEAT_COUNT    <span class="built_in">BIGINT</span>(<span class="number">7</span>)    <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  REPEAT_INTERVAL <span class="built_in">BIGINT</span>(<span class="number">12</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  TIMES_TRIGGERED <span class="built_in">BIGINT</span>(<span class="number">10</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),</span><br><span class="line">  <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)</span><br><span class="line">  <span class="keyword">REFERENCES</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> QRTZ_CRON_TRIGGERS</span><br><span class="line">(</span><br><span class="line">  SCHED_NAME      <span class="built_in">VARCHAR</span>(<span class="number">120</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  TRIGGER_NAME    <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  TRIGGER_GROUP   <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  CRON_EXPRESSION <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  TIME_ZONE_ID    <span class="built_in">VARCHAR</span>(<span class="number">80</span>),</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),</span><br><span class="line">  <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)</span><br><span class="line">  <span class="keyword">REFERENCES</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> QRTZ_SIMPROP_TRIGGERS</span><br><span class="line">(</span><br><span class="line">  SCHED_NAME    <span class="built_in">VARCHAR</span>(<span class="number">120</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  TRIGGER_NAME  <span class="built_in">VARCHAR</span>(<span class="number">200</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  TRIGGER_GROUP <span class="built_in">VARCHAR</span>(<span class="number">200</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  STR_PROP_1    <span class="built_in">VARCHAR</span>(<span class="number">512</span>)   <span class="literal">NULL</span>,</span><br><span class="line">  STR_PROP_2    <span class="built_in">VARCHAR</span>(<span class="number">512</span>)   <span class="literal">NULL</span>,</span><br><span class="line">  STR_PROP_3    <span class="built_in">VARCHAR</span>(<span class="number">512</span>)   <span class="literal">NULL</span>,</span><br><span class="line">  INT_PROP_1    <span class="built_in">INT</span>            <span class="literal">NULL</span>,</span><br><span class="line">  INT_PROP_2    <span class="built_in">INT</span>            <span class="literal">NULL</span>,</span><br><span class="line">  LONG_PROP_1   <span class="built_in">BIGINT</span>         <span class="literal">NULL</span>,</span><br><span class="line">  LONG_PROP_2   <span class="built_in">BIGINT</span>         <span class="literal">NULL</span>,</span><br><span class="line">  DEC_PROP_1    <span class="built_in">NUMERIC</span>(<span class="number">13</span>, <span class="number">4</span>) <span class="literal">NULL</span>,</span><br><span class="line">  DEC_PROP_2    <span class="built_in">NUMERIC</span>(<span class="number">13</span>, <span class="number">4</span>) <span class="literal">NULL</span>,</span><br><span class="line">  BOOL_PROP_1   <span class="built_in">VARCHAR</span>(<span class="number">1</span>)     <span class="literal">NULL</span>,</span><br><span class="line">  BOOL_PROP_2   <span class="built_in">VARCHAR</span>(<span class="number">1</span>)     <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),</span><br><span class="line">  <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)</span><br><span class="line">  <span class="keyword">REFERENCES</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> QRTZ_BLOB_TRIGGERS</span><br><span class="line">(</span><br><span class="line">  SCHED_NAME    <span class="built_in">VARCHAR</span>(<span class="number">120</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  TRIGGER_NAME  <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  TRIGGER_GROUP <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  BLOB_DATA     <span class="built_in">BLOB</span>         <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),</span><br><span class="line">  <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)</span><br><span class="line">  <span class="keyword">REFERENCES</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> QRTZ_CALENDARS</span><br><span class="line">(</span><br><span class="line">  SCHED_NAME    <span class="built_in">VARCHAR</span>(<span class="number">120</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  CALENDAR_NAME <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  CALENDAR      <span class="built_in">BLOB</span>         <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (SCHED_NAME, CALENDAR_NAME)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> QRTZ_PAUSED_TRIGGER_GRPS</span><br><span class="line">(</span><br><span class="line">  SCHED_NAME    <span class="built_in">VARCHAR</span>(<span class="number">120</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  TRIGGER_GROUP <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (SCHED_NAME, TRIGGER_GROUP)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> QRTZ_FIRED_TRIGGERS</span><br><span class="line">(</span><br><span class="line">  SCHED_NAME        <span class="built_in">VARCHAR</span>(<span class="number">120</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  ENTRY_ID          <span class="built_in">VARCHAR</span>(<span class="number">95</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  TRIGGER_NAME      <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  TRIGGER_GROUP     <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  INSTANCE_NAME     <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  FIRED_TIME        <span class="built_in">BIGINT</span>(<span class="number">13</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIORITY</span>          <span class="built_in">INTEGER</span>      <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  STATE             <span class="built_in">VARCHAR</span>(<span class="number">16</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  JOB_NAME          <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="literal">NULL</span>,</span><br><span class="line">  JOB_GROUP         <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="literal">NULL</span>,</span><br><span class="line">  IS_NONCONCURRENT  <span class="built_in">VARCHAR</span>(<span class="number">1</span>)   <span class="literal">NULL</span>,</span><br><span class="line">  REQUESTS_RECOVERY <span class="built_in">VARCHAR</span>(<span class="number">1</span>)   <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (SCHED_NAME, ENTRY_ID)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> QRTZ_SCHEDULER_STATE</span><br><span class="line">(</span><br><span class="line">  SCHED_NAME        <span class="built_in">VARCHAR</span>(<span class="number">120</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  INSTANCE_NAME     <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  LAST_CHECKIN_TIME <span class="built_in">BIGINT</span>(<span class="number">13</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  CHECKIN_INTERVAL  <span class="built_in">BIGINT</span>(<span class="number">13</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (SCHED_NAME, INSTANCE_NAME)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> QRTZ_LOCKS</span><br><span class="line">(</span><br><span class="line">  SCHED_NAME <span class="built_in">VARCHAR</span>(<span class="number">120</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  LOCK_NAME  <span class="built_in">VARCHAR</span>(<span class="number">40</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (SCHED_NAME, LOCK_NAME)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>1.quartz的集群配置各个节点一定要时间同步</p>
<p>2.注意适当设置工作线程的数量</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://antfling.github.io/2017/01/12/sprintcloudconfig/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ant">
      <meta itemprop="description" content="Es Ist Vorbei">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Antfling">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/12/sprintcloudconfig/" class="post-title-link" itemprop="url">SpringCloudConfig开发配置及使用文档</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-12 18:38:00" itemprop="dateCreated datePublished" datetime="2017-01-12T18:38:00+08:00">2017-01-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-29 14:52:07" itemprop="dateModified" datetime="2020-09-29T14:52:07+08:00">2020-09-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring/" itemprop="url" rel="index"><span itemprop="name">spring</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="SpringCloudConfig开发配置及使用文档"><a href="#SpringCloudConfig开发配置及使用文档" class="headerlink" title="SpringCloudConfig开发配置及使用文档"></a>SpringCloudConfig开发配置及使用文档</h2><h3 id="开发配置"><a href="#开发配置" class="headerlink" title="开发配置"></a>开发配置</h3><h4 id="ConfigServe"><a href="#ConfigServe" class="headerlink" title="ConfigServe"></a>ConfigServe</h4><ul>
<li>依赖配置</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">	ext &#123;</span><br><span class="line">		springBootVersion = <span class="string">'1.4.3.RELEASE'</span></span><br><span class="line">	&#125;</span><br><span class="line">	repositories &#123;</span><br><span class="line">		mavenCentral()</span><br><span class="line">	&#125;</span><br><span class="line">	dependencies &#123;</span><br><span class="line">		classpath(<span class="string">"org.springframework.boot:spring-boot-gradle-plugin:$&#123;springBootVersion&#125;"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'java'</span></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'eclipse'</span></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'org.springframework.boot'</span></span><br><span class="line"></span><br><span class="line">jar &#123;</span><br><span class="line">	baseName = <span class="string">'sprint-cloud-config-demo'</span></span><br><span class="line">	version = <span class="string">'0.0.1-SNAPSHOT'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sourceCompatibility = <span class="number">1.8</span></span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">	maven &#123; url <span class="string">"http://maven.aliyun.com/nexus/content/groups/public/"</span> &#125;</span><br><span class="line">	maven &#123; url <span class="string">"http://clojars.org/repo/"</span> &#125;</span><br><span class="line">	maven &#123; url <span class="string">'https://repo.spring.io/libs-milestone'</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">	compile(<span class="string">'org.springframework.cloud:spring-cloud-config-server'</span>)</span><br><span class="line">	testCompile(<span class="string">'org.springframework.boot:spring-boot-starter-test'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencyManagement &#123;</span><br><span class="line">	imports &#123;</span><br><span class="line">		mavenBom <span class="string">"org.springframework.cloud:spring-cloud-dependencies:Camden.SR3"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>文件配置</li>
</ul>
<p>配置文件为项目resources文件下的application.properties文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#uri配置可为远程的git仓库文件i.e:http://domain.com/project/repo,下面的为本地git仓库配置</span><br><span class="line">spring.cloud.config.server.git.uri=file:$&#123;user.home&#125;/IdeaProjects/remote-application-config</span><br><span class="line">#search-paths配置uri下面可扫面的文件下，默认是指扫描uri目录，子目录不扫描.可配置多个，以逗号隔开</span><br><span class="line">spring.cloud.config.server.git.search-paths=hello_world</span><br><span class="line">server.port=8888</span><br></pre></td></tr></table></figure>

<ul>
<li>git仓库目录结构</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">/&#123;application&#125;/&#123;profile&#125;[/&#123;label&#125;]</span></span><br><span class="line"><span class="string">/&#123;application&#125;-&#123;profile&#125;.yml</span></span><br><span class="line"><span class="string">/&#123;label&#125;/&#123;application&#125;-&#123;profile&#125;.yml</span></span><br><span class="line"><span class="string">/&#123;application&#125;-&#123;profile&#125;.properties</span></span><br><span class="line"><span class="string">/&#123;label&#125;/&#123;application&#125;-&#123;profile&#125;.properties</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>tips</p>
<p>1.对应的配置在client中配置spring.cloud.config为prefix的配置,具体请看下面的client配置</p>
<p>2.配置项目应该加上@EnableConfigServer注解</p>
<p>3.spring web项目集成cloud config的时候最好加上映射的前缀</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.config.server.prefix=remote-config</span><br></pre></td></tr></table></figure>

<p>​</p>
</li>
</ul>
<h4 id="ConfigClient"><a href="#ConfigClient" class="headerlink" title="ConfigClient"></a>ConfigClient</h4><ul>
<li><p>依赖配置</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">	ext &#123;</span><br><span class="line">		springBootVersion = <span class="string">'1.4.3.RELEASE'</span></span><br><span class="line">	&#125;</span><br><span class="line">	repositories &#123;</span><br><span class="line">		mavenCentral()</span><br><span class="line">	&#125;</span><br><span class="line">	dependencies &#123;</span><br><span class="line">		classpath(<span class="string">"org.springframework.boot:spring-boot-gradle-plugin:$&#123;springBootVersion&#125;"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'java'</span></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'eclipse'</span></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'org.springframework.boot'</span></span><br><span class="line"></span><br><span class="line">jar &#123;</span><br><span class="line">	baseName = <span class="string">'spring-cloud-client-demo'</span></span><br><span class="line">	version = <span class="string">'0.0.1-SNAPSHOT'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sourceCompatibility = <span class="number">1.8</span></span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">	maven &#123; url <span class="string">"http://maven.aliyun.com/nexus/content/groups/public/"</span> &#125;</span><br><span class="line">	maven &#123; url <span class="string">"http://clojars.org/repo/"</span> &#125;</span><br><span class="line">	maven &#123; url <span class="string">'https://repo.spring.io/libs-milestone'</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">	compile(<span class="string">"org.springframework.boot:spring-boot-starter-actuator"</span>)</span><br><span class="line">	compile(<span class="string">'org.springframework.cloud:spring-cloud-starter-config'</span>)</span><br><span class="line">	compile(<span class="string">'org.springframework.boot:spring-boot-starter-web'</span>)</span><br><span class="line">	compile(<span class="string">'org.projectlombok:lombok'</span>)</span><br><span class="line">	testCompile(<span class="string">'org.springframework.boot:spring-boot-starter-test'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencyManagement &#123;</span><br><span class="line">	imports &#123;</span><br><span class="line">		mavenBom <span class="string">"org.springframework.cloud:spring-cloud-dependencies:Camden.SR3"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>文件配置</p>
<p>配置文件为项目resources文件下的application.properties文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=hello_world</span><br><span class="line">##client配置</span><br><span class="line">spring.cloud.config.discovery.serviceId=db23de</span><br><span class="line">spring.cloud.config.label=master</span><br><span class="line">spring.cloud.config.profile=db23de</span><br><span class="line">spring.cloud.config.uri=http://localhost:8888</span><br><span class="line">###需要用户名密码时可配置下面两个</span><br><span class="line">#spring.cloud.config.password=password</span><br><span class="line">#spring.cloud.config.username=username</span><br><span class="line">##client配置</span><br><span class="line">hello.world.name=hello world</span><br></pre></td></tr></table></figure>
</li>
<li><p>tips</p>
<p>1.在需要刷新配置的class前加上@RefreshScope注解,这样刷新等待时候就会刷新这一部分而不必restart</p>
<p>2.在启动配置的地方加上@EnableDiscoveryClient注解</p>
</li>
</ul>
<h3 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h3><ul>
<li><p>1.在configClient下建立一个controller内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;hello.world.name&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​</p>
</li>
<li><p>2.有序启动configServe和configClinet</p>
</li>
<li><p>3.访问client的根路径，浏览器返回的是 hello world</p>
</li>
<li><p>4.在git.uri(configServe中配置的)路径下建立文件命令为hello_world-db23de.properties({applicationName}-{profile}.properties}),这里采用的是这一种文件格式.内容为hello.world.name=hello db23de</p>
</li>
<li><p>5.访问client/refresh,post请求</p>
</li>
<li><p>6.访问client的根路径，浏览器返回的是 hello db23de</p>
</li>
<li><p>7.client要加上访问远程访问的前缀需要覆盖一下spring cloud config client的源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ConfigServicePropertySourceLocator(line:148)&#123;</span><br><span class="line">     String path = &quot;/&#123;your-prefix&#125;/&#123;name&#125;/&#123;profile&#125;&quot;;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>​</p>
<p>​</p>
</li>
</ul>
<h3 id="相关demo"><a href="#相关demo" class="headerlink" title="相关demo"></a>相关demo</h3><p>1.<a href="https://github.com/airlove/spring-cloud-config-client-demo" target="_blank" rel="noopener">spring-cloud-config-client-demo</a></p>
<p>2.<a href="https://github.com/airlove/spring-cloud-config-serve-demo" target="_blank" rel="noopener">spring-cloud-config-serve-demo</a></p>
<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p>1.<a href="http://cloud.spring.io/spring-cloud-static/spring-cloud-config/1.2.2.RELEASE/" target="_blank" rel="noopener">spring-cloud-config-document</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://antfling.github.io/2017/01/10/seyren-source-diy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ant">
      <meta itemprop="description" content="Es Ist Vorbei">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Antfling">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/10/seyren-source-diy/" class="post-title-link" itemprop="url">seyren插件源码解读</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-10 18:30:00" itemprop="dateCreated datePublished" datetime="2017-01-10T18:30:00+08:00">2017-01-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-29 14:52:07" itemprop="dateModified" datetime="2020-09-29T14:52:07+08:00">2020-09-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/seyren/" itemprop="url" rel="index"><span itemprop="name">seyren</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="seyren插件源码解读"><a href="#seyren插件源码解读" class="headerlink" title="seyren插件源码解读"></a>seyren插件源码解读</h2><h3 id="不支持失联警报"><a href="#不支持失联警报" class="headerlink" title="不支持失联警报"></a>不支持失联警报</h3><h4 id="来源"><a href="#来源" class="headerlink" title="来源:"></a>来源:</h4><p>这个问题主要是seyren的作者认为graphite返回的null值有很多种情况，不确定哪一种是有效的数据。所以对失联的这种情况就没有加状态报警。</p>
<h4 id="解决："><a href="#解决：" class="headerlink" title="解决："></a>解决：</h4><p>首先确保数据能够正常返回，失联的时候数据肯定为null，没有其他因素感染,然后修改源码,主要是修改CheckRunner,修改的代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.seyren.core.service.schedule;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Map.Entry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.joda.time.DateTime;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.base.Optional;</span><br><span class="line"><span class="keyword">import</span> com.seyren.core.domain.Alert;</span><br><span class="line"><span class="keyword">import</span> com.seyren.core.domain.AlertType;</span><br><span class="line"><span class="keyword">import</span> com.seyren.core.domain.Check;</span><br><span class="line"><span class="keyword">import</span> com.seyren.core.domain.Subscription;</span><br><span class="line"><span class="keyword">import</span> com.seyren.core.service.checker.TargetChecker;</span><br><span class="line"><span class="keyword">import</span> com.seyren.core.service.checker.ValueChecker;</span><br><span class="line"><span class="keyword">import</span> com.seyren.core.service.notification.NotificationService;</span><br><span class="line"><span class="keyword">import</span> com.seyren.core.store.AlertsStore;</span><br><span class="line"><span class="keyword">import</span> com.seyren.core.store.ChecksStore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckRunner</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(CheckRunner<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Check check;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AlertsStore alertsStore;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChecksStore checksStore;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TargetChecker targetChecker;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ValueChecker valueChecker;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Iterable&lt;NotificationService&gt; notificationServices;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CheckRunner</span><span class="params">(Check check, AlertsStore alertsStore, ChecksStore checksStore, TargetChecker targetChecker, ValueChecker valueChecker,</span></span></span><br><span class="line"><span class="function"><span class="params">                       Iterable&lt;NotificationService&gt; notificationServices)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.check = check;</span><br><span class="line">        <span class="keyword">this</span>.alertsStore = alertsStore;</span><br><span class="line">        <span class="keyword">this</span>.checksStore = checksStore;</span><br><span class="line">        <span class="keyword">this</span>.targetChecker = targetChecker;</span><br><span class="line">        <span class="keyword">this</span>.valueChecker = valueChecker;</span><br><span class="line">        <span class="keyword">this</span>.notificationServices = notificationServices;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!check.isEnabled()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Map&lt;String, Optional&lt;BigDecimal&gt;&gt; targetValues = targetChecker.check(check);</span><br><span class="line"></span><br><span class="line">            DateTime now = <span class="keyword">new</span> DateTime();</span><br><span class="line">            BigDecimal warn = check.getWarn();</span><br><span class="line">            BigDecimal error = check.getError();</span><br><span class="line"></span><br><span class="line">            AlertType worstState;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (check.isAllowNoData()) &#123;</span><br><span class="line">                worstState = AlertType.OK;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                worstState = AlertType.UNKNOWN;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            List&lt;Alert&gt; interestingAlerts = <span class="keyword">new</span> ArrayList&lt;Alert&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (Entry&lt;String, Optional&lt;BigDecimal&gt;&gt; entry : targetValues.entrySet()) &#123;</span><br><span class="line"></span><br><span class="line">                String target = entry.getKey();</span><br><span class="line">                Optional&lt;BigDecimal&gt; value = entry.getValue();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!value.isPresent() &amp;&amp; check.isAllowNoData()) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//如果不允许有空数据,则当!value.isPresent() 的时候，currentValue=null;</span></span><br><span class="line">                BigDecimal currentValue = !value.isPresent() ? <span class="keyword">null</span> : value.get();</span><br><span class="line"></span><br><span class="line">                Alert lastAlert = alertsStore.getLastAlertForTargetOfCheck(target, check.getId());</span><br><span class="line"></span><br><span class="line">                AlertType lastState;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (lastAlert == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    lastState = AlertType.UNKNOWN;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    lastState = lastAlert.getToType();</span><br><span class="line">                &#125;</span><br><span class="line">                AlertType currentState;</span><br><span class="line">                <span class="comment">//如果不允许有空数据,则当!value.isPresent() 的时候,是不需要进行阈值比较的</span></span><br><span class="line">                <span class="keyword">if</span> (value.isPresent()) &#123;</span><br><span class="line">                    currentState = valueChecker.checkValue(currentValue, warn, error);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    currentState = worstState;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (value.isPresent() &amp;&amp; currentState.isWorseThan(worstState)) &#123;</span><br><span class="line">                    worstState = currentState;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (isStillOk(lastState, currentState)) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// Only notify if the alert has changed state</span></span><br><span class="line">                <span class="keyword">if</span> (stateIsTheSame(lastState, currentState)) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//只有target中包含health.status的才发失联消息</span></span><br><span class="line">                <span class="keyword">if</span> (currentState == AlertType.UNKNOWN &amp;&amp; !target.contains(<span class="string">"health.status"</span>)) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                 <span class="comment">//刚部署的组件默认是UNKNOWN,有数值后是ok，这个变化和业务需求不符合,但是包含health.status的指标是可以传的</span></span><br><span class="line">                 <span class="keyword">if</span> (lastAlert == <span class="keyword">null</span> &amp;&amp; currentState == AlertType.OK &amp;&amp; !target.contains(<span class="string">"health.status"</span>)) &#123;</span><br><span class="line">                     <span class="keyword">continue</span>;</span><br><span class="line">                 &#125;</span><br><span class="line">                Alert alert = createAlert(target, currentValue, warn, error, lastState, currentState, now);</span><br><span class="line">                alertsStore.createAlert(check.getId(), alert);</span><br><span class="line">                <span class="keyword">if</span> (lastAlert == <span class="keyword">null</span> &amp;&amp; currentState == AlertType.OK &amp;&amp; !target.contains(<span class="string">"health.status"</span>)) &#123;</span><br><span class="line">                     <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                interestingAlerts.add(alert);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            notification(interestingAlerts, worstState, now);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            LOGGER.warn(<span class="string">"&#123;&#125; failed"</span>, check.getName(), e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isStillOk</span><span class="params">(AlertType last, AlertType current)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> last == AlertType.OK &amp;&amp; current == AlertType.OK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">stateIsTheSame</span><span class="params">(AlertType last, AlertType current)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> last == current;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Alert <span class="title">createAlert</span><span class="params">(String target, BigDecimal value, BigDecimal warn, BigDecimal error, AlertType from, AlertType to, DateTime now)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Alert()</span><br><span class="line">                .withTarget(target)</span><br><span class="line">                .withValue(value)</span><br><span class="line">                .withWarn(warn)</span><br><span class="line">                .withError(error)</span><br><span class="line">                .withFromType(from)</span><br><span class="line">                .withToType(to)</span><br><span class="line">                .withTimestamp(now);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">notification</span><span class="params">(List&lt;Alert&gt; interestingAlerts, AlertType worstState, DateTime now)</span> </span>&#123;</span><br><span class="line">        Check updatedCheck = checksStore.updateStateAndLastCheck(check.getId(), worstState, DateTime.now());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (interestingAlerts.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Subscription subscription : updatedCheck.getSubscriptions()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!subscription.shouldNotify(now, worstState)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (NotificationService notificationService : notificationServices) &#123;</span><br><span class="line">                <span class="keyword">if</span> (notificationService.canHandle(subscription.getType())) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        notificationService.sendNotification(updatedCheck, subscription, interestingAlerts);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        LOGGER.warn(<span class="string">"Notifying &#123;&#125; by &#123;&#125; failed."</span>, subscription.getTarget(), subscription.getType(), e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GraphiteTargetChecker.check(Check check)如下修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;String, Optional&lt;BigDecimal&gt;&gt; check(Check check) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Map&lt;String, Optional&lt;BigDecimal&gt;&gt; targetValues = <span class="keyword">new</span> HashMap&lt;String, Optional&lt;BigDecimal&gt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            JsonNode node = graphiteHttpClient.getTargetJson(check.getTarget(), check.getFrom(), check.getUntil());</span><br><span class="line">            <span class="keyword">for</span> (JsonNode metric : node) &#123;</span><br><span class="line">                String target = metric.path(<span class="string">"target"</span>).asText();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    BigDecimal value = getLatestValue(metric);</span><br><span class="line">                    targetValues.put(target, Optional.of(value));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InvalidGraphiteValueException e) &#123;</span><br><span class="line">                    <span class="comment">// Silence these - we don't know what's causing Graphite to return null values</span></span><br><span class="line">                    LOGGER.warn(<span class="string">"&#123;&#125; failed to read from Graphite"</span>, check.getName(), e);</span><br><span class="line">                    targetValues.put(target, Optional.&lt;BigDecimal&gt;absent());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (node.size() == <span class="number">0</span>) &#123;</span><br><span class="line">                targetValues.put(check.getTarget(), Optional.&lt;BigDecimal&gt;absent());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (GraphiteReadException e) &#123;</span><br><span class="line">            LOGGER.warn(check.getName() + <span class="string">" failed to read from Graphite"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> targetValues;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>CheckScheduler中修改一个performChecks方法，添加一个performHealthChecks</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 普通指标的检查频率比健康检查的快是为了减少健康检查对普通指标以及整个组件的影响</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Scheduled</span>(fixedRateString = <span class="string">"$&#123;GRAPHITE_REFRESH:60000&#125;"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">performChecks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       List&lt;Check&gt; checks = checksStore.getChecks(<span class="keyword">true</span>, <span class="keyword">false</span>).getValues();</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">final</span> Check check : checks) &#123;</span><br><span class="line">           <span class="keyword">if</span> (!check.getTarget().contains(<span class="string">"health.status"</span>)) &#123;</span><br><span class="line">               executor.execute(checkRunnerFactory.create(check));</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 健康检查的频率比正常的指标检查时间要慢点，刚好是设置的默认健康检查的时间段一致</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Scheduled</span>(fixedRateString = <span class="string">"120000"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">performHealthChecks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       List&lt;Check&gt; checks = checksStore.getChecks(<span class="keyword">true</span>, <span class="keyword">false</span>).getValues();</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">final</span> Check check : checks) &#123;</span><br><span class="line">           <span class="keyword">if</span> (check.getTarget().contains(<span class="string">"health.status"</span>)) &#123;</span><br><span class="line">               executor.execute(checkRunnerFactory.create(check));</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>之后打web项目包即可</p>
<h3 id="功能支持"><a href="#功能支持" class="headerlink" title="功能支持"></a>功能支持</h3><p>seyren本质上也是调用graphite的api,所以对于graphite的可以支持匹配查询，seyren也是支持匹配添加监控</p>
<h3 id="发现的bug"><a href="#发现的bug" class="headerlink" title="发现的bug"></a>发现的bug</h3><p>seyren目前发现的bug是在使用的过程中具有相同的状态的metric也会发报警过来</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://antfling.github.io/2017/01/09/flume-interceptor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ant">
      <meta itemprop="description" content="Es Ist Vorbei">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Antfling">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/09/flume-interceptor/" class="post-title-link" itemprop="url">Flume配置与自定义过滤器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-09 17:25:00" itemprop="dateCreated datePublished" datetime="2017-01-09T17:25:00+08:00">2017-01-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-29 14:52:07" itemprop="dateModified" datetime="2020-09-29T14:52:07+08:00">2020-09-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/BigData/" itemprop="url" rel="index"><span itemprop="name">BigData</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Flume配置与自定义过滤器"><a href="#Flume配置与自定义过滤器" class="headerlink" title="Flume配置与自定义过滤器"></a>Flume配置与自定义过滤器</h2><h3 id="1-安装Flume"><a href="#1-安装Flume" class="headerlink" title="1.安装Flume"></a>1.安装Flume</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># yum -y install flume</span><br><span class="line"># 或者从apache flume官网上下载响应的压缩包解压即可</span><br></pre></td></tr></table></figure>

<h3 id="2-配置"><a href="#2-配置" class="headerlink" title="2.配置"></a>2.配置</h3><ul>
<li><p>Flume只需要配置一下JDK路径就可以运行了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># echo $JAVE_HOME</span><br><span class="line">/usr/java/latest(这是TDH自带的JDK路径)</span><br><span class="line"># cd /usr/lib/flume/conf</span><br><span class="line"># cp flume-env.sh.template flume-env.sh</span><br><span class="line"># vim flume-env.sh</span><br><span class="line"># 找到 # export JAVA_HOME=/usr/lib/jvm/java-6-sun 这一行，修改为系统的JDK路径</span><br><span class="line"># export JAVA_HOME=/usr/java/latest</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="3-使用"><a href="#3-使用" class="headerlink" title="3.使用"></a>3.使用</h3><ul>
<li><p>使用之前了解下Flume架构</p>
<p>  <img src="http://i.imgur.com/oFu9606.png" alt="Flume-ng框架图"></p>
<ul>
<li>说明：source接收不仅是web server,sink的对象不仅是HDFS;主要是看矩形内的图形</li>
<li>Source:收集各种方式传递来的数据，如：<ul>
<li>Avro Source（这个重点掌握，监控架构用的是这种方式）</li>
<li>Exec Source</li>
<li>Spooling Directory Source</li>
<li>NetCat Source</li>
<li>Syslog Sources等等</li>
</ul>
</li>
<li>Sink：将收集数据发送到指定的组件中，如：<ul>
<li>Kafka sink（这个重点掌握，监控架构用的是这种方式）</li>
<li>HDFS Sink</li>
<li>Logger Sink</li>
<li>Avro Sink</li>
<li>File RollSink等等</li>
</ul>
</li>
<li>Channel：连接 sources 和 sinks ，数据会从sources进入到channel中去，然后再给到sinks中，这个有点像一个队列。Channel类型如下：<ul>
<li>Memory Channel(内存队列)</li>
<li>JDBC Channel(把事件存储在数据库)</li>
<li>File Channel</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="4-这里首先配置一个简单的模式（查看flume是否配置成功）："><a href="#4-这里首先配置一个简单的模式（查看flume是否配置成功）：" class="headerlink" title="4.这里首先配置一个简单的模式（查看flume是否配置成功）："></a>4.这里首先配置一个简单的模式（查看flume是否配置成功）：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- 使用NetCat Source传递数据，使用memory channel缓存，显示到Logger Sink（控制台上）</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># cd /usr/lib/flume/conf</span><br><span class="line"> 		# vim netcat-logger.conf  </span><br><span class="line"></span><br><span class="line">#定义主机(a1),以及各组件名称 </span><br><span class="line">a1.sources= r1  </span><br><span class="line">a1.sinks= k1  </span><br><span class="line">a1.channels= c1  </span><br><span class="line">   </span><br><span class="line">#定义source  </span><br><span class="line">a1.sources.r1.type= netcat  </span><br><span class="line">a1.sources.r1.bind= localhost  </span><br><span class="line">a1.sources.r1.port= 44444  </span><br><span class="line">a1.sources.r1.channels= c1</span><br><span class="line">   </span><br><span class="line">#定义Sink  </span><br><span class="line">a1.sinks.k1.type= logger </span><br><span class="line">a1.sinks.k1.channel= c1 </span><br><span class="line">   </span><br><span class="line">#定义Channel  </span><br><span class="line">a1.channels.c1.type= memory  </span><br><span class="line">a1.channels.c1.capacity= 1000  </span><br><span class="line">a1.channels.c1.transactionCapacity= 100</span><br></pre></td></tr></table></figure>

<ul>
<li><p>运行并测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cd /usr/lib/flume/</span><br><span class="line"># flume-ng agent -n a1 -c conf -f conf/netcat-logger.conf  -Dflume.root.logger=INFO,console</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数命令</p>
<ul>
<li>-c conf 指定配置目录为conf</li>
<li>-f conf/netcat-logger.conf指定配置文件为conf/netcat-logger.conf</li>
<li>-n a1 指定agent名字为a1,需要与netcat-logger.conf中的一致</li>
<li>-Dflume.root.logger=INFO,console指定DEBUF模式在console输出INFO信息</li>
<li>具体参数命令请通过flume-nghelp查看</li>
</ul>
</li>
<li><p>然后在另一个终端进行测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet 127.0.0.1 44444</span><br></pre></td></tr></table></figure>

<p>然后在之前启动的终端查看console是否有输出，有则说明Flume能正常使用</p>
</li>
</ul>
<h3 id="5-自定义过滤器"><a href="#5-自定义过滤器" class="headerlink" title="5.自定义过滤器"></a>5.自定义过滤器</h3><p>过滤器需要实现Interceptor接口,并在此类中再写一个类中类实现Interceptor.Builder接口,切记这个类中类必须用static修饰，不然会报InstantiationException(无法初始化的异常),相关代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">package com.demo.flume.interceptor;</span><br><span class="line"></span><br><span class="line">import com.google.common.collect.Lists;</span><br><span class="line">import org.apache.commons.logging.Log;</span><br><span class="line">import org.apache.commons.logging.LogFactory;</span><br><span class="line">import org.apache.flume.Context;</span><br><span class="line">import org.apache.flume.Event;</span><br><span class="line">import org.apache.flume.interceptor.Interceptor;</span><br><span class="line">import org.joda.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class TimestampInterceptor implements Interceptor &#123;</span><br><span class="line"></span><br><span class="line">    Log log = LogFactory.getLog(TimestampInterceptor.class);</span><br><span class="line"></span><br><span class="line">    public TimestampInterceptor() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initialize() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Event intercept(Event event) &#123;</span><br><span class="line">        String body = new String(event.getBody());</span><br><span class="line">        log.info(&quot;start:&quot;+body);</span><br><span class="line">        LocalDateTime now = LocalDateTime.now();</span><br><span class="line">        body = body.replaceFirst(&quot;[0-9]&#123;2&#125;:[0-9]&#123;2&#125;:[0-9]&#123;2&#125;\\.[0-9]&#123;3&#125;&quot;, now.toString(&quot;HH:mm:ss.SSS&quot;));</span><br><span class="line">        event.setBody(body.getBytes());</span><br><span class="line">        log.info(&quot;end:&quot;+body);</span><br><span class="line">        return event;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;Event&gt; intercept(List&lt;Event&gt; events) &#123;</span><br><span class="line">        List&lt;Event&gt; out = Lists.newArrayList();</span><br><span class="line">        for (Event event : events) &#123;</span><br><span class="line">            Event outEvent = intercept(event);</span><br><span class="line">            if (outEvent != null) &#123;</span><br><span class="line">                out.add(outEvent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void close() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">//切记这里需要加上static进行修饰</span><br><span class="line">    public static class Builder implements Interceptor.Builder &#123;</span><br><span class="line">        public Builder() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public Interceptor build() &#123;</span><br><span class="line">            return new TimestampInterceptor();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void configure(Context context) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-自定义过滤器的使用"><a href="#6-自定义过滤器的使用" class="headerlink" title="6.自定义过滤器的使用"></a>6.自定义过滤器的使用</h3><p>在第四步中的配置添加如下配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a1.sources.r1.interceptors = i1</span><br><span class="line">a1.sources.r1.interceptors.i1.type = com.antfling.flume.interceptor.TimestampInterceptor$Builder</span><br></pre></td></tr></table></figure>

<p>在flume的home目录下建立 一个plugins.d目录(这个目录是flume使用的第三方插件的支持目录，会自动加载进来)，在plugins.d目录下建立一个目录timestamp-interceptor(名字随意，但是要唯一）,在timestamp-interceptor目录下建立如下目录</p>
<ul>
<li>建立lib目录，这个目录放入刚刚写好的过滤器打包的jar包.</li>
<li>建立libext目录,这个里面放过滤器需要的依赖包(没有可不创建这个目录)</li>
<li>建立native目录，这个里面放过滤器需要的底层依赖(例如source.so,没有可不创建这个目录)</li>
</ul>
<p>之后重启flume即可</p>
<h3 id="7-注意事项"><a href="#7-注意事项" class="headerlink" title="7.注意事项"></a>7.注意事项</h3><ul>
<li>注意过滤器的类中类要用static修饰,过滤器和类中类都要有无参构造方法</li>
<li>打包注意尽量使用gradle或者maven自带的打包插件，我这原先是spring boot项目打出的包是可运行的包，不是依赖包，所以会有问题</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Ant</p>
  <div class="site-description" itemprop="description">Es Ist Vorbei</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">35</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ant</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.5.1.min.js" ></script> 
<script type="text/javascript"> 
/* 鼠标特效 */
var a_idx = 0; 
jQuery(document).ready(function($) { 
    $("body").click(function(e) { 
        var a = new Array("富强", "民主", "文明", "和谐", "自由", "平等", "公正" ,"法治", "爱国", "敬业", "诚信", "友善"); 
        var $i = $("<span/>").text(a[a_idx]); 
        a_idx = (a_idx + 1) % a.length; 
        var x = e.pageX, 
        y = e.pageY; 
        $i.css({ 
            "z-index": 999999999999999999999999999999999999999999999999999999999999999999999, 
            "top": y - 20, 
            "left": x, 
            "position": "absolute", 
            "font-weight": "bold", 
            "color": "#ff6651" 
        }); 
        $("body").append($i); 
        $i.animate({ 
            "top": y - 180, 
            "opacity": 0 
        }, 
        1500, 
        function() { 
            $i.remove(); 
        }); 
    }); 
}); 
</script>
</html>
